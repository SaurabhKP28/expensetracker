<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Expense Tracker</title>
  <link rel="stylesheet" href="css/styles.css" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap">
</head>
<body>
  <header class="header">
    <div class="container header-container">
      <div class="logo">ExpenseTracker</div>
      <div class="user-actions">
        <button id="upgrade-btn" class="btn-accent">Upgrade to Premium</button>
        <button onclick="logout()" class="btn-outline">Logout</button>
      </div>
    </div>
  </header>

  <main class="container">
    <h1>Expense Tracker</h1>

    <div class="expense-container">
      <div class="expense-form-card">
        <h2>Add New Expense</h2>
        <form id="expense-form">
          <div class="form-group">
            <label for="amount">Amount ($):</label>
            <input type="number" id="amount" required min="0" step="0.01">
          </div>
          <div class="form-group">
            <label for="category">Category:</label>
            <select id="category" required>
              <option value="">Select a category</option>
              <option value="Food">Food</option>
              <option value="Transportation">Transportation</option>
              <option value="Entertainment">Entertainment</option>
              <option value="Shopping">Shopping</option>
              <option value="Utilities">Utilities</option>
              <option value="Other">Other</option>
            </select>
          </div>
          <div class="form-group">
            <label for="description">Description:</label>
            <input type="text" id="description" required>
          </div>
          <div class="form-group">
            <label for="frequency">Expense Frequency:</label>
            <select id="frequency" required>
              <option value="">Select frequency</option>
              <option value="daily">Daily</option>
              <option value="weekly" selected>Weekly</option>
              <option value="monthly">Monthly</option>
            </select>
          </div>
          <button type="submit" class="btn">Add Expense</button>
        </form>
      </div>

      <div class="expense-list">
        <div class="expense-header">
          <h2>Your Expenses</h2>
          <button id="download-expenses-btn" class="btn-outline" style="float:right;margin-top:-40px;">Download Expenses</button>
        </div>

        <div id="expenses-container">
          <div class="text-center">Loading expenses...</div>
        </div>

        <div class="pagination">
          <button id="prev-page-btn" class="page-button" disabled>&lt;</button>
          <span id="current-page">1</span>
          <button id="next-page-btn" class="page-button">&gt;</button>
        </div>
      </div>
    </div>
  </main>

  <footer>
    <div class="container">
      <p>&copy; 2025 ExpenseTracker. All rights reserved.</p>
    </div>
  </footer>

  <script src="js/auth.js"></script>
  <script src="js/expense.js"></script>

  <!-- âœ… Download button script -->
 <script>
document.getElementById('download-expenses-btn').addEventListener('click', async () => {
  const token = localStorage.getItem('token');
  try {
    const res = await fetch('/s3/download', {
      method: 'GET',
      headers: {
        'Authorization': `Bearer ${token}`
      }
    });
    const data = await res.json();
    if (res.ok && data.fileURL) {
      // Create a temporary <a> element to trigger download
      const a = document.createElement('a');
      a.href = data.fileURL;
      // Optionally set a default filename (will work if CORS headers allow)
      a.download = data.fileURL.split('/').pop();
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
    } else {
      alert('Download failed.');
    }
  } catch (err) {
    console.error('Download error:', err);
    alert('An error occurred while downloading.');
  }
});
</script>
</body>
</html>
